// ============================================
// JAVASCRIPT - LANDING PAGE PENSIONES
// ============================================

// Esperar a que el DOM estÃ© completamente cargado
document.addEventListener('DOMContentLoaded', function() {
    
    // ============================================
    // SMOOTH SCROLL PARA NAVEGACIÃ“N
    // ============================================
    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener('click', function (e) {
            e.preventDefault();
            const target = document.querySelector(this.getAttribute('href'));
            if (target) {
                target.scrollIntoView({
                    behavior: 'smooth',
                    block: 'start'
                });
            }
        });
    });

    // ============================================
    // ANIMACIÃ“N DE ENTRADA PARA ELEMENTOS
    // ============================================
    const observerOptions = {
        threshold: 0.1,
        rootMargin: '0px 0px -50px 0px'
    };

    const observer = new IntersectionObserver(function(entries) {
        entries.forEach(entry => {
            if (entry.isIntersecting) {
                entry.target.style.opacity = '1';
                entry.target.style.transform = 'translateY(0)';
            }
        });
    }, observerOptions);

    // Aplicar animaciÃ³n a tarjetas y elementos
    const animatedElements = document.querySelectorAll('.service-card, .testimonial-card, .step');
    animatedElements.forEach(el => {
        el.style.opacity = '0';
        el.style.transform = 'translateY(20px)';
        el.style.transition = 'opacity 0.6s ease, transform 0.6s ease';
        observer.observe(el);
    });

    // ============================================
    // EFECTO PARALLAX SUAVE EN HERO
    // ============================================
    window.addEventListener('scroll', function() {
        const scrolled = window.pageYOffset;
        const hero = document.querySelector('.hero');
        if (hero && scrolled < 600) {
            hero.style.transform = 'translateY(' + (scrolled * 0.5) + 'px)';
        }
    });

    // ============================================
    // TRACKING DE CLICKS EN BOTONES DE WHATSAPP
    // (Ãštil para analÃ­tica si se implementa despuÃ©s)
    // ============================================
    const whatsappButtons = document.querySelectorAll('a[href*="wa.me"]');
    whatsappButtons.forEach(button => {
        button.addEventListener('click', function() {
            // AquÃ­ puedes agregar cÃ³digo para tracking con Google Analytics
            // Ejemplo: gtag('event', 'click', { 'event_category': 'WhatsApp', 'event_label': 'CTA Click' });
            console.log('Click en botÃ³n de WhatsApp');
        });
    });

    // ============================================
    // MOSTRAR/OCULTAR BOTÃ“N FLOTANTE AL HACER SCROLL
    // ============================================
    const whatsappFloat = document.querySelector('.whatsapp-float');
    let lastScrollPosition = 0;

    window.addEventListener('scroll', function() {
        const currentScrollPosition = window.pageYOffset;
        
        // Mostrar el botÃ³n despuÃ©s de 200px de scroll
        if (currentScrollPosition > 200) {
            whatsappFloat.style.opacity = '1';
            whatsappFloat.style.visibility = 'visible';
        } else {
            whatsappFloat.style.opacity = '0';
            whatsappFloat.style.visibility = 'hidden';
        }
        
        lastScrollPosition = currentScrollPosition;
    });

    // Inicializar el botÃ³n flotante como oculto
    whatsappFloat.style.transition = 'opacity 0.3s ease, visibility 0.3s ease';
    whatsappFloat.style.opacity = '0';
    whatsappFloat.style.visibility = 'hidden';

    // ============================================
    // VALIDACIÃ“N Y FORMATEO DE NÃšMEROS DE TELÃ‰FONO
    // (Por si se agrega un formulario en el futuro)
    // ============================================
    function formatPhoneNumber(phoneNumber) {
        // Eliminar caracteres no numÃ©ricos
        const cleaned = phoneNumber.replace(/\D/g, '');
        
        // Formatear como (55) 1234-5678
        if (cleaned.length === 10) {
            return `(${cleaned.substring(0, 2)}) ${cleaned.substring(2, 6)}-${cleaned.substring(6)}`;
        }
        return phoneNumber;
    }

    // ============================================
    // LAZY LOADING PARA IMÃGENES
    // (Mejora el rendimiento de carga)
    // ============================================
    if ('IntersectionObserver' in window) {
        const imageObserver = new IntersectionObserver((entries, observer) => {
            entries.forEach(entry => {
                if (entry.isIntersecting) {
                    const img = entry.target;
                    if (img.dataset.src) {
                        img.src = img.dataset.src;
                        img.removeAttribute('data-src');
                        imageObserver.unobserve(img);
                    }
                }
            });
        });

        // Observar todas las imÃ¡genes con data-src
        document.querySelectorAll('img[data-src]').forEach(img => {
            imageObserver.observe(img);
        });
    }

    // ============================================
    // PREVENIR SPAM EN CLICKS DE WHATSAPP
    // ============================================
    let lastClickTime = 0;
    const clickDelay = 1000; // 1 segundo entre clicks

    whatsappButtons.forEach(button => {
        button.addEventListener('click', function(e) {
            const currentTime = Date.now();
            if (currentTime - lastClickTime < clickDelay) {
                e.preventDefault();
                console.log('Por favor espera un momento antes de hacer click nuevamente');
                return false;
            }
            lastClickTime = currentTime;
        });
    });

    // ============================================
    // DETECCIÃ“N DE DISPOSITIVO MÃ“VIL
    // ============================================
    function isMobileDevice() {
        return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
    }

    // Ajustar comportamiento segÃºn el dispositivo
    if (isMobileDevice()) {
        // En mÃ³viles, los botones de WhatsApp abren la app directamente
        console.log('Dispositivo mÃ³vil detectado');
    } else {
        // En desktop, abren WhatsApp Web
        console.log('Dispositivo de escritorio detectado');
    }

    // ============================================
    // MENSAJE DE CONSOLA (OPCIONAL - PUEDES ELIMINARLO)
    // ============================================
    console.log('%cðŸ‘‹ Bienvenido a AsesorÃ­a en Pensiones', 'color: #006847; font-size: 20px; font-weight: bold;');
    console.log('%cSi necesitas ayuda tÃ©cnica, contÃ¡ctanos', 'color: #666; font-size: 14px;');

});

// ============================================
// FUNCIÃ“N PARA CAMBIAR NÃšMERO DE WHATSAPP GLOBALMENTE
// Cambia el nÃºmero aquÃ­ y se actualizarÃ¡ en todos los botones
// ============================================
function updateWhatsAppNumber(newNumber) {
    const whatsappLinks = document.querySelectorAll('a[href*="wa.me"]');
    whatsappLinks.forEach(link => {
        const currentHref = link.getAttribute('href');
        const message = currentHref.split('?text=')[1] || '';
        link.setAttribute('href', `https://wa.me/${newNumber}?text=${message}`);
    });
    console.log(`NÃºmero de WhatsApp actualizado a: ${newNumber}`);
}

// Ejemplo de uso (descomenta para probar):
// updateWhatsAppNumber('525512345678');